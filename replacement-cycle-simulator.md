# 代替え期間比較シミュレーター 設計・指示書

## プロジェクト概要

車の乗り替えサイクルによる総コスト差をシミュレーションするWebツール。
「10年1台乗り続け」vs「5年×2台乗り替え」の金額差を可視化し、
トヨタディーラーの営業現場でお客様への提案ツールとして使用する。

### 既存ツールとの関係
- **燃費比較** (`fuel-compare-simulator`): HEV vs ガソリン車の燃費・コスト比較
- **車両コスト比較** (`car-cost-comparison`): 新車 vs 中古車の購入・維持費比較
- **本ツール** (`replacement-cycle-simulator`): 乗り替えサイクルの総コスト比較 ← 今回作成

3ツールとも同じデザインシステム・UI設計思想で統一する。

---

## 技術スタック

- **単一HTMLファイル**（index.html のみ）
- **外部ライブラリ**: Chart.js（CDN）
- **フォント**: Google Fonts（Noto Sans JP, Zen Kaku Gothic New）
- **ホスティング**: GitHub Pages（`tyknk.github.io/replacement-cycle-simulator/`）
- **フレームワーク不要**：バニラJS + CSS

---

## デザインシステム（既存ツールと統一）

### カラーパレット（和モダン）
```css
:root {
  /* ベース */
  --ink: #1a1a1a;
  --ink-light: #4a4a4a;
  --ink-muted: #7a7a7a;
  --paper: #f7f5f0;
  --paper-warm: #ede9e0;
  --card: #ffffff;
  --border: #d8d2c4;
  --border-light: #e8e4da;

  /* 比較色（本ツール用） */
  --plan-a: #2d6a8a;       /* 10年1台: 青系 */
  --plan-a-bg: #e8f0f4;
  --plan-b: #8a4a2d;       /* 5年×2台: 暖色系 */
  --plan-b-bg: #f4ece8;
  --saving: #3d7a5a;       /* 差額・お得表示: 緑系 */
  --saving-bg: #e8f4ed;
}
```

### デザイン原則
- **AI生成感の排除**: グラデーション背景、ネオン色、角丸過多を避ける
- **和モダン**: 温かみのある紙色ベース、墨色テキスト、控えめなアクセント
- **実用重視**: 営業現場でタブレットで見せることを想定
- **レスポンシブ**: スマホ〜タブレット対応

---

## 入力パラメータ設計

すべてスライダー＋数値入力ボックスの双方向バインディング。

### 車両価格セクション
| パラメータ | デフォルト値 | 最小 | 最大 | ステップ | 単位 |
|-----------|------------|------|------|---------|------|
| 新車購入価格 | 2,700,000 | 1,000,000 | 8,000,000 | 100,000 | 円 |
| 5年後売却額（残価） | 1,300,000 | 0 | 5,000,000 | 100,000 | 円 |
| 10年後売却額 | 300,000 | 0 | 3,000,000 | 100,000 | 円 |
| 2台目購入価格 | 2,700,000 | 1,000,000 | 8,000,000 | 100,000 | 円 |

### 維持費セクション（新車 / 中古車 共通マスタ）
| パラメータ | 新車デフォルト | 中古車デフォルト | 最小 | 最大 | ステップ | 単位 |
|-----------|-------------|---------------|------|------|---------|------|
| 車検整備費用 | 50,000 | 50,000 | 0 | 200,000 | 5,000 | 円/回 |
| 車検法定費用 | 40,000 | 40,000 | 0 | 100,000 | 5,000 | 円/回 |
| 定期点検費用 | 30,000 | 30,000 | 0 | 100,000 | 5,000 | 円/年 |
| タイヤ交換費用 | 100,000 | 100,000 | 0 | 300,000 | 10,000 | 円/回 |
| バッテリー交換費用 | 25,000 | 25,000 | 0 | 100,000 | 5,000 | 円/回 |
| 一般整備費用 | 30,000 | 30,000 | 0 | 100,000 | 5,000 | 円/年 |
| 自動車税年額 | 36,000 | 36,000 | 0 | 100,000 | 1,000 | 円/年 |

---

## 計算ロジック

### パターンA: 10年1台乗り続け

```
年0: 新車購入価格
年1: 定期点検 + 自動車税
年2: 定期点検 + 自動車税
年3: 車検整備 + 車検法定 + バッテリー交換 + 自動車税
年4: 定期点検 + 自動車税
年5: 車検整備 + 車検法定 + タイヤ交換 + 自動車税
年6: 一般整備 + バッテリー交換 + 自動車税 + 定期点検
年7: 車検整備 + 車検法定 + 一般整備 + 自動車税
年8: 定期点検 + 一般整備 + 自動車税
年9: 車検整備 + 車検法定 + 一般整備 + 自動車税
年10: 10年後売却額（マイナス計上）
```

**注意**: 年数が経つほど一般整備費用がかかる（6年目以降は一般整備を毎年計上）

### パターンB: 5年×2台乗り替え

```
年0: 新車購入価格（1台目）
年1: 定期点検 + 自動車税
年2: 定期点検 + 自動車税
年3: 車検整備 + 車検法定 + バッテリー交換 + 自動車税
年4: 定期点検 + 自動車税
年5: 1台目売却（-5年後売却額）+ 2台目購入価格
年6: 定期点検 + 自動車税（2台目）
年7: 定期点検 + 自動車税（2台目）
年8: 車検整備 + 車検法定 + バッテリー交換 + 自動車税（2台目）
年9: 定期点検 + 自動車税（2台目）
年10: 2台目売却（-5年後売却額）
```

**ポイント**: 5年で売ることで大きな修理費が発生する前に乗り替える

### サマリー計算
```
10年総額A = Σ(年0〜年10のコスト) - 10年後売却額
10年総額B = Σ(年0〜年10のコスト) - 5年後売却額×2（1台目・2台目）
合計差額 = 総額B - 総額A
年間維持費A = 総額A / 10
年間維持費B = 総額B / 10
年間維持費差額 = 年間維持費B - 年間維持費A
```

---

## 出力・表示設計

### 1. サマリーKPIカード（上部）
3枚のカードを横並び（モバイルは縦並び）

| カード | 表示内容 | 色 |
|-------|---------|-----|
| 10年1台 総額 | ¥6,180,000 | --plan-a |
| 5年×2台 総額 | ¥5,910,000 | --plan-b |
| 差額 | ¥270,000 お得 | --saving（お得な方を強調） |

### 2. 年別コスト比較表
- 行: 年0〜年10
- 列: 年数 | 10年1台コスト | 5年×2台コスト | 年間差額
- 累計行を追加
- 差額がプラスの年は緑、マイナスの年は赤（薄い背景色）
- 車購入年・売却年はハイライト表示

### 3. 累積コスト推移グラフ（Chart.js）
- 折れ線グラフ
- X軸: 0〜10年
- Y軸: 累積コスト（円）
- 2本の線: plan-a色（10年1台）、plan-b色（5年×2台）
- 交差ポイント（損益分岐）をハイライト
- 5年目に売却・購入イベントのアノテーション

### 4. コスト内訳比較（積み上げ棒グラフ）
- 2本の棒: 10年1台 / 5年×2台
- 内訳: 車両購入費、車検費、点検費、タイヤ、バッテリー、一般整備、税金、売却回収分

---

## UI レイアウト

```
┌─────────────────────────────────────┐
│  ヘッダー: 代替え期間比較            │
├─────────────────────────────────────┤
│  [KPIカード×3: 総額A / 総額B / 差額] │
├──────────────┬──────────────────────┤
│  入力パネル   │  グラフエリア         │
│  ├ 車両価格   │  ├ 累積コスト推移     │
│  ├ 維持費     │  ├ コスト内訳比較     │
│  └ (折りたたみ)│                     │
├──────────────┴──────────────────────┤
│  年別コスト比較表                    │
├─────────────────────────────────────┤
│  フッター                           │
└─────────────────────────────────────┘
```

### モバイル時
- 入力パネルとグラフエリアが縦並び
- 維持費セクションは折りたたみ（アコーディオン）で省スペース

---

## スライダー＋入力ボックスの実装仕様

既存ツールと同じ双方向バインディング方式:

```javascript
// スライダー変更 → 入力ボックス同期 → 再計算
slider.addEventListener('input', () => {
  inputBox.value = formatNumber(slider.value);
  calculate();
});

// 入力ボックス変更 → スライダー同期 → 再計算
inputBox.addEventListener('change', () => {
  const val = parseNumber(inputBox.value);
  if (!isNaN(val)) {
    slider.value = clamp(val, slider.min, slider.max);
    calculate();
  }
});

// Enterキーでフォーカスを外す
inputBox.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { e.preventDefault(); inputBox.blur(); }
});
```

### 数値フォーマット
- 表示: カンマ区切り（例: 2,700,000）
- 単位: 「円」は入力ボックス右に配置
- 金額: ¥マークまたは「円」表記で統一

---

## 将来の拡張を意識した設計

### データ構造
比較期間やサイクルをパラメータ化して、後で拡張しやすくする。

```javascript
const config = {
  totalYears: 10,          // → 将来15年に拡張
  cycleYears: 5,           // → 将来3年パターン追加
  plans: [
    { name: '10年1台', replacements: 0 },
    { name: '5年×2台', replacements: 1 },
    // → 将来追加: { name: '3年×3台', replacements: 2 }
  ]
};
```

### 維持費スケジュール生成関数
年数に応じた維持費スケジュールを関数で生成する方式にして、
サイクル数が変わっても自動対応できるようにする。

```javascript
function generateMaintenanceSchedule(startYear, years, isNewCar) {
  // 新車の場合: 初回車検3年目、以降2年ごと
  // 中古車の場合: 初回車検2年目、以降2年ごと（車齢による）
  // タイヤ: 4-5年ごと
  // バッテリー: 3年ごと
  // 一般整備: 5年目以降は毎年加算
}
```

---

## ファイル構成

```
replacement-cycle-simulator/
├── index.html          # 単一HTMLファイル（CSS・JS インライン）
├── README.md           # プロジェクト説明
└── .github/
    └── (GitHub Pages設定)
```

---

## 実装の優先順位

1. HTML構造とCSSレイアウト（和モダンUI）
2. スライダー＋入力ボックスの実装
3. 計算ロジック（パターンA・B）
4. サマリーKPIカード表示
5. 年別コスト比較表
6. 累積コスト推移グラフ（Chart.js折れ線）
7. コスト内訳比較グラフ（Chart.js積み上げ棒）
8. レスポンシブ対応
9. 印刷対応

---

## 参照: 元データ（スプレッドシートの値）

### 入力パラメータ
- 新車購入価格: 2,700,000円
- 5年後残価: 1,300,000円
- 5年目購入価格: 2,700,000円
- 5年後残価（2台目）: 1,300,000円
- 10年後購入価格: 2,700,000円

### 維持費マスタ
| 項目 | 新車 | 中古車 |
|------|------|--------|
| 車検整備費用 | 50,000 | 50,000 |
| 車検法定費用 | 40,000 | 40,000 |
| 定期点検費用 | 30,000 | 30,000 |
| タイヤ交換 | 100,000 | 100,000 |
| バッテリー交換 | 25,000 | 25,000 |
| 一般整備費用年額 | 30,000 | 30,000 |
| 自動車税年額 | 36,000 | 36,000 |

### 計算結果（検算用）
- 10年1台合計: 6,180,000円
- 5年×2台合計: 5,910,000円
- 合計差額: -270,000円（5年×2台の方が安い）
- 年間維持費（10年1台）: 618,000円
- 年間維持費（5年×2台）: 591,000円
- 年間維持費差額: -27,000円
